import{j as e,u as y,D as f,T as v,S,V as T,E as I,a as G}from"./index-vZQlsG4i.js";import{r as d}from"./vendor-react-jVyfcstf.js";import{d as N,f as k,e as E,g as F,h as R,i as _}from"./vendor-ui-tl2xT55i.js";function A({title:s,children:t,defaultOpen:h=!1,className:r=""}){const[o,i]=d.useState(h);return e.jsxs("div",{className:`collapsible-section ${o?"open":""} ${r}`,"data-testid":"collapsible-section",children:[e.jsxs("button",{className:"collapsible-header",onClick:()=>i(!o),"aria-expanded":o,"data-testid":"collapsible-header",children:[e.jsx("span",{className:"collapsible-icon",children:o?e.jsx(N,{size:20}):e.jsx(k,{size:20})}),e.jsx("h2",{className:"collapsible-title",children:s})]}),o&&e.jsx("div",{className:"collapsible-content","data-testid":"collapsible-content",children:t})]})}const O=d.memo(function({trigger:t,surveys:h,isEnabled:r,selectedSurveyId:o,onToggle:i,onSurveyChange:m}){const{t:u}=y(),x=`trigger_${t.id}`,c=u(x)||t.key;return e.jsxs("div",{className:`trigger-row ${r?"enabled":""}`,"data-testid":`trigger-row-${t.id}`,children:[e.jsx("div",{className:"trigger-checkbox-cell",children:e.jsxs("label",{className:"checkbox-wrapper",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:g=>i(t.id,g.target.checked),"aria-label":`Enable ${c}`,"data-testid":`trigger-checkbox-${t.id}`}),e.jsx("span",{className:"checkbox-custom"})]})}),e.jsx("div",{className:"trigger-name-cell",children:e.jsx("span",{className:"trigger-name",children:c})}),e.jsx("div",{className:"trigger-survey-cell",children:e.jsxs("div",{className:"select-wrapper",children:[e.jsxs("select",{value:o||"",onChange:g=>m(t.id,g.target.value||null),disabled:!r,className:"survey-select","aria-label":`Select survey for ${c}`,"data-testid":`trigger-select-${t.id}`,children:[e.jsx("option",{value:"",children:u("select_survey")}),h.map(g=>e.jsx("option",{value:g.id,children:u(g.nameKey)},g.id))]}),e.jsx(N,{size:16,className:"select-arrow"})]})})]})}),p={AGENT_CONFIG:"fidspark_agent_config",TRIGGER_CONFIG:"fidspark_trigger_config"};function $(){if(typeof window>"u")return f;const s=localStorage.getItem(p.AGENT_CONFIG);if(s)try{return JSON.parse(s)}catch{return f}return f}function z(s){typeof window>"u"||localStorage.setItem(p.AGENT_CONFIG,JSON.stringify(s))}function H(){if(typeof window>"u")return j();const s=localStorage.getItem(p.TRIGGER_CONFIG);if(s)try{return JSON.parse(s)}catch{return j()}return j()}function W(s){typeof window>"u"||localStorage.setItem(p.TRIGGER_CONFIG,JSON.stringify(s))}function j(){const s={};return v.forEach(t=>{s[t.id]={enabled:!1,surveyId:null}}),s.online_purchase={enabled:!0,surveyId:"nps_purchase"},s.after_sales={enabled:!0,surveyId:"nps_service"},s.body_repair={enabled:!0,surveyId:"post_repair"},s}function J(){const{t:s}=y(),[t,h]=d.useState(!1),[r,o]=d.useState(H),[i,m]=d.useState($),u=d.useCallback((a,l)=>{o(n=>{var b;return{...n,[a]:{...n[a],enabled:l,surveyId:l?(b=n[a])==null?void 0:b.surveyId:null}}})},[]),x=d.useCallback((a,l)=>{o(n=>({...n,[a]:{...n[a],surveyId:l}}))},[]),c=d.useCallback((a,l)=>{m(n=>({...n,[a]:l}))},[]),g=d.useCallback((a,l)=>{m(n=>({...n,escalationTriggers:{...n.escalationTriggers,[a]:l}}))},[]),C=d.useCallback(()=>{W(r),z(i),h(!0),setTimeout(()=>h(!1),3e3)},[r,i]),w=d.useMemo(()=>Object.values(r).filter(a=>a.enabled).length,[r]);return e.jsxs("div",{className:"ai-agent-settings","data-testid":"ai-agent-page",children:[e.jsxs("div",{className:"settings-header",children:[e.jsxs("div",{className:"settings-title-section",children:[e.jsx("div",{className:"settings-icon",children:e.jsx(E,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"settings-title",children:s("page_title_ai_agent")}),e.jsx("p",{className:"settings-description",children:s("ai_agent_description")})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsxs("span",{className:"enabled-count","data-testid":"enabled-count",children:[w," / ",v.length," ",s("enabled").toLowerCase()]}),e.jsx("button",{className:`save-btn ${t?"success":""}`,onClick:C,"data-testid":"save-btn",children:t?e.jsxs(e.Fragment,{children:[e.jsx(F,{size:18}),e.jsx("span",{children:s("settings_saved")})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{size:18}),e.jsx("span",{children:s("save_settings")})]})})]})]}),e.jsx("div",{className:"settings-card","data-testid":"trigger-settings-card",children:e.jsx(A,{title:s("trigger_settings"),defaultOpen:!1,children:e.jsxs("div",{className:"trigger-table",children:[e.jsxs("div",{className:"trigger-table-header",children:[e.jsx("div",{className:"trigger-checkbox-cell",children:e.jsx("span",{children:s("enabled")})}),e.jsx("div",{className:"trigger-name-cell",children:e.jsx("span",{children:s("trigger")})}),e.jsx("div",{className:"trigger-survey-cell",children:e.jsx("span",{children:s("survey")})})]}),e.jsx("div",{className:"trigger-table-body",children:v.map(a=>{var l,n;return e.jsx(O,{trigger:a,surveys:S,isEnabled:((l=r[a.id])==null?void 0:l.enabled)||!1,selectedSurveyId:(n=r[a.id])==null?void 0:n.surveyId,onToggle:u,onSurveyChange:x},a.id)})})]})})}),e.jsxs("div",{className:"settings-card agent-config-card","data-testid":"agent-config-card",children:[e.jsx("div",{className:"settings-card-header",children:e.jsx("h2",{children:s("agent_configuration")})}),e.jsxs("div",{className:"agent-config-content",children:[e.jsx("p",{className:"section-description",children:s("agent_config_description")}),e.jsxs("div",{className:"config-grid",children:[e.jsxs("div",{className:"config-field",children:[e.jsx("label",{htmlFor:"startAfterHours",children:s("start_after_hours")}),e.jsx("input",{type:"number",id:"startAfterHours",value:i.startAfterHours,onChange:a=>c("startAfterHours",parseInt(a.target.value)||0),min:"0",className:"config-input","data-testid":"input-start-after"}),e.jsx("span",{className:"field-hint",children:s("start_after_hours_hint")})]}),e.jsxs("div",{className:"config-field",children:[e.jsx("label",{htmlFor:"retryIntervalHours",children:s("retry_interval_hours")}),e.jsx("input",{type:"number",id:"retryIntervalHours",value:i.retryIntervalHours,onChange:a=>c("retryIntervalHours",parseInt(a.target.value)||0),min:"0",className:"config-input","data-testid":"input-retry-interval"}),e.jsx("span",{className:"field-hint",children:s("retry_interval_hours_hint")})]}),e.jsxs("div",{className:"config-field",children:[e.jsx("label",{htmlFor:"maxRetries",children:s("max_retries")}),e.jsx("input",{type:"number",id:"maxRetries",value:i.maxRetries,onChange:a=>c("maxRetries",parseInt(a.target.value)||0),min:"0",className:"config-input","data-testid":"input-max-retries"})]}),e.jsxs("div",{className:"config-field",children:[e.jsx("label",{htmlFor:"voiceType",children:s("voice_type")}),e.jsxs("div",{className:"select-wrapper",children:[e.jsx("select",{id:"voiceType",value:i.voiceType,onChange:a=>c("voiceType",a.target.value),className:"config-select","data-testid":"select-voice-type",children:T.map(a=>e.jsx("option",{value:a.id,children:s(a.nameKey)},a.id))}),e.jsx(N,{size:16,className:"select-arrow"})]})]}),e.jsxs("div",{className:"config-field",children:[e.jsx("label",{htmlFor:"callWindowFrom",children:s("call_window_from")}),e.jsxs("div",{className:"time-input-wrapper",children:[e.jsx("input",{type:"time",id:"callWindowFrom",value:i.callWindowFrom,onChange:a=>c("callWindowFrom",a.target.value),className:"config-input time-input","data-testid":"input-call-from"}),e.jsx(_,{size:16,className:"time-icon"})]})]}),e.jsxs("div",{className:"config-field",children:[e.jsx("label",{htmlFor:"callWindowTo",children:s("call_window_to")}),e.jsxs("div",{className:"time-input-wrapper",children:[e.jsx("input",{type:"time",id:"callWindowTo",value:i.callWindowTo,onChange:a=>c("callWindowTo",a.target.value),className:"config-input time-input","data-testid":"input-call-to"}),e.jsx(_,{size:16,className:"time-icon"})]})]})]}),e.jsxs("div",{className:"config-field full-width",children:[e.jsx("label",{htmlFor:"personaScript",children:s("persona_script")}),e.jsx("textarea",{id:"personaScript",value:i.personaScript,onChange:a=>c("personaScript",a.target.value),className:"config-textarea",rows:4,"data-testid":"textarea-persona-script"}),e.jsx("span",{className:"field-hint",children:s("persona_script_hint")})]}),e.jsxs("div",{className:"escalation-section","data-testid":"escalation-section",children:[e.jsx("h3",{children:s("create_dispute_when")}),e.jsx("div",{className:"escalation-triggers",children:I.map(a=>e.jsx(G,{id:a.id,checked:i.escalationTriggers[a.id]||!1,onChange:l=>g(a.id,l),label:s(a.labelKey),description:s(a.descriptionKey)},a.id))})]})]})]})]})}export{J as AIAgentPage,J as default};
